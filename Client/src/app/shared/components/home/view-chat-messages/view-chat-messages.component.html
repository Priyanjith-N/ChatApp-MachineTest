<div class="flex flex-col flex-auto gap-[2px] h-full">
    <div class="w-full py-4 px-8 bg-[#2C2C2C] flex items-center justify-between">
        <div class="flex flex-auto items-center gap-4 max-w-full">
            <div>
                @if(chat && chat.type === "group") {
                    <img class="w-[44px] rounded-full h-auto" [src]="chat.groupProfilePicture!.url" alt="">
                }@else if(chat) {
                    <img class="w-[44px] rounded-full h-auto" [src]="( chat.participantsData | getReciverProfileData )?.profilePicture?.url" alt="">
                }
            </div>
            <div class="flex items-baseline justify-between w-full">
                @if(chat && chat.type === "group") {
                    <p class="font-medium">{{ chat.groupName }}</p>
                }@else if(chat) {
                    <p class="font-medium">{{ ( chat.participantsData | getReciverProfileData )?.displayName }}</p>
                }
            </div>
        </div>
        <div class="px-2.5 py-2 rounded-[5.07px] flex-initial transition-all duration-300 ease-in-out hover:bg-[#3A3A3A] relative">
            <img class="w-[20px] h-auto" src="/icons/searchIcon.png" alt="">
        </div>
    </div>
    <div class="flex-1 bg-no-repeat bg-center bg-[#252424c7] pr-1">
        <div #viewChatDiv class="flex-1 flex flex-col gap-[2px] px-4 overflow-y-auto chatSection max-h-[76vh] pb-8">
            @if(!messages.length) {
                <div class="my-2 flex justify-center">
                    <div class="p-2 text-[10px] bg-[#1B1B1B] hover:bg-[#252424c7] rounded-[5.07px] text-[#959595] select-none">
                        Today
                    </div>
                </div>
            }

            @for (dayByMessage of messages; track $index) {
                <div class="my-2 flex justify-center">
                    <div class="p-2 text-[10px] bg-[#1B1B1B] hover:bg-[#252424c7] rounded-[5.07px] text-[#959595] select-none">
                        {{ dayByMessage.createdAt | dateFormaterForChat }}
                    </div>
                </div>
                @for (message of dayByMessage.messages; track $index) {
                    @if(isMessagedByCurrentUser(message)) {
                        <div class="flex justify-end">
                            <div class="bubble bubbleSend p-1.5 min-w-[10%] w-fit max-w-[30%] h-auto">
                                @if(message.type === "text") {
                                    <p class="break-words">{{ message.content }}</p>
                                }@else if(message.file) {
                                    <div class="mb-2">
                                        <img class="h-auto object-scale-down md:w-full lg:w-[250px]" [src]="message.file.url" alt="">
                                    </div>
                                }
                                <div class="flex justify-end items-center gap-1.5">
                                    <div>
                                        <p class="text-[11px] text-[#959595]">{{ message.createdAt | formateTime }}</p>
                                    </div>
                                    <div>
                                        @if(message.isRead) {
                                            <img class="w-[14px] h-auto transition-transform duration-300 ease-in-out scale-100 animate-scale" src="/icons/readMeassage.png" alt="tick">
                                        }@else {
                                            <img class="w-[14px] h-auto transition-transform duration-300 ease-in-out scale-100 animate-scale" src="/icons/norReadMessage.png" alt="tick">
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }@else {
                        <div class="flex justify-start">
                            <div class="bubble bubbleRecive p-1.5 min-w-[10%] w-fit max-w-[40%] h-auto">
                                @if(message.type === "text") {
                                    <p class="break-words">{{ message.content }}</p>
                                }@else if(message.file) {
                                    <div class="mb-2">
                                        <img class="h-auto object-scale-down md:w-full lg:w-[250px]" [src]="message.file.url" alt="">
                                    </div>
                                }
                                <div class="flex justify-end items-center gap-1.5">
                                    <div>
                                        <p class="text-[11px] text-[#959595]">{{ message.createdAt | formateTime }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            }
        </div>
    </div>
    <div class="bg-[#2C2C2C] py-1.5 items-center">
        <form  [formGroup]="chatForm" (submit)="sendMessage();">
            <div class="flex px-2">
                <div class="flex mr-4 items-center gap-2">
                    <div (click)="showOrCloseEmojiPicker();" class="relative px-2.5 py-2 rounded-[5.07px] transition-all duration-300 ease-in-out hover:bg-[#3A3A3A]">
                        <img class="w-[20px] h-auto" src="/icons/emojiIcon.png" alt="">
                        <div #emojiDiv class="absolute duration-300 ease-in-out -top-4 -translate-y-full -translate-x-1/2 hidden" [class.display]="showEmojiPicker" ></div>
                    </div>
                    <label for="file">
                        <div class="px-2.5 py-2 rounded-[5.07px] transition-all duration-300 ease-in-out hover:bg-[#3A3A3A] relative">
                            <input id="file" type="file" class="hidden" (change)="onFileSelected($event)" />
                            <img class="w-[20px] h-auto" src="/icons/attachFile.png" alt="">
                        </div> 
                    </label>
                </div>
                <div class="flex-1" >
                    <input #chatMessageInput formControlName="content" type="text" class="w-full py-1.5 bg-transparent border-transparent outline-none placeholder:text-[#979797]" placeholder="Type a message">
                </div>
                <button type="submit">
                    <div class="px-2.5 py-2 rounded-[5.07px] transition-all duration-300 ease-in-out hover:bg-[#3A3A3A] relative">
                        <img class="w-[20px] h-auto" src="/icons/sendMessage.png" alt="">
                    </div> 
                </button>
            </div>
        </form>
    </div>
</div>